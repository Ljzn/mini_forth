-module(merkle_root).

%% Calcuate the Merkle Root of a list of TXIDs.
%%
%% This module is not be used now, but maybe have some
%% usecase in future.

-export([get_merkle_root/1, test/0]).

get_merkle_root(L) -> pairs_merkle(L).

pairs_merkle([H]) -> H;
pairs_merkle(L) ->
    P = pairs(L), pairs_merkle(upper_hashes(P)).

pairs([H1, H2 | T]) -> [[H1, H2] | pairs(T)];
pairs([H | _T]) -> [[H, H]];
pairs([]) -> [].

upper_hashes(L) -> [concat_hash(H) || H <- L].

concat_hash([H1, H2]) ->
    double256(<<H1/binary, H2/binary>>).

double256(B) ->
    crypto:hash(sha256, crypto:hash(sha256, B)).

%% Test

test() ->
    <<21644490086796831080784417335260913359701558157355586538697315409420834338130:256/little>> =
	get_merkle_root([<<108154941466389028190436022308777677375329616133551212191559649272327178089379:256/little>>,
			 <<113071953036121305465923878849516104698993019429113893006131184369631385316615:256/little>>,
			 <<99227867482063846117560123381854828745662578036736398746272811451788659122478:256/little>>,
			 <<15404672958857398238076079517038567826654321050659706339113531972534643841146:256/little>>,
			 <<51429133651599136791805622605296167592347480119081293566982956243859132006222:256/little>>,
			 <<114972921794172489264181856245237368920346516855404944195789322240129252573920:256/little>>,
			 <<15298984480426079152862154887638359967457304978115938890790244859203188824455:256/little>>,
			 <<100017365664541825629886765593454064842384337811810963128870095893104511815763:256/little>>,
			 <<52847292095442771517064715482051335628099033920861202417017899776567935311648:256/little>>]).
